# 👏🏻<span style="color: coral">프로세스<span/>

> CPU 자원을 받아 프로그램 내에서 연속적으로 실행되고 있는 프로그램

- 운영체제 위에서 독립적으로 메모리에서 실행되는 프로그램
- 각각의 프로세스는 저마다 리소스(메모리, 데이터) 자원들이 할당 되어져 있음

<br/>

## 🙋🏻‍♂️프로세스 목록?

<img width="337" alt="스크린샷 2021-06-14 오전 3 22 41" src="https://user-images.githubusercontent.com/75716128/121991343-6ec68280-cdda-11eb-817d-2915f0e3bea2.png">

<br/>

## 🙋🏻‍♂️프로세스 안에 있는 것들?

- 프로세스를 실행하기 위한 `코드`
- 동작 순서인 `스택`
  : 함수들이 어떤 순서로 실행되어야 하는지, 어디로 가는지에 대한 정보 저장
- 데이터들이 들어있는 `힙과 데이터`
  : 오브젝트를 생성하거나 데이터를 만들 때 데이터를 저장하는 공간

> 힙에는 동적으로 할당된 변수들이 저장 vs 데이터는 전역 변수나 스태틱 변수들이 할당

<br/>

# <span style="color: coral">👏🏻쓰레드</span>

> 프로세스 안에 있는 일꾼, 일꾼이 많다면 동시에 할 수 있는 것들이 그만큼 많아짐

- 함수 각각의 호출을 기억하기 위해 쓰레드마다 스택이 할당
- 결국 프로세스를 위해서 존재하기 때문에 프로세스에 지정된 코드나 데이터 힙에 `공통적으로` 접근이 가능(업데이트 가능)
- 예를들어, 앱에서 영상을 송출하면서 다른 것이 가능한 점
- 쓰레드가 있기 때문에 다양한 일들이 가능

> 쓰레드는 스택, 프로세스는 자원이라는 컨셉이기 때문에 서로간에 공유하면서 사용됨

> 따라서 멀티쓰레딩을 잘 못하면 동시에 무언가를 할 때 순서가 맞지 않으면 발생할 수 있는 경우가 있음.

<br/>

## 🙋🏻‍♂️멀티 쓰레딩?

</br>

> 멀티 쓰레딩으로 인해 효율적인 프로그래밍이 가능해짐

- 지원여부⭐️⭐️⭐️⭐️⭐️

  - Java:

    - 서버에서 데이터를 받아오는 것 👉 쓰레드A에서 하겠다 등등이 가능
    - 쓰레드 동작 갯수 설정 가능
    - 그래서 자바로는 배워야 하는 것들이 많음

  - JS:

    - Single Threaded Language
    - JS언어 자체에는 멀티 쓰레딩x
    - 이 함수는 백그라운드에서, 이 함수는 쓰레드B 에서 등등이 불가
    - 그러나, 브라우저라는 프로그램 안에서는 여러가지의 쓰레드가 존재✨
    - 그래서 브라우저 웹APIs를 활용하여 멀티쓰레딩이 가능토록 하는 것✨
    - 그리고 JS가 동작하는 런타임 환경에서 즉, JS실행 환경에서는 APIs를 활용하는 것 뿐만 아니라 이벤트 루프를 이용해서 다양한 동작이 가능하도록 함✨

<br>

# <span style="color: coral">👏🏻JS런타임 환경</span>

> 컨셉: 프로세스 안에는 `힙과 스택`이 있는 것과 동일하게 JS엔진에도 `메모리 힙과 콜 스택` 등이 있음

<br/>

## 🙋🏻‍♂️메모리 힙과 콜 스택?

- 메모리 힙:

  - 변수를 선언해서 오브젝트 문자 숫자를 할당하면 그 데이터들은 전부 다 메모리 힙에 저장
  - 구조적으로 정리된 자료구조x, 여기저기 아무곳에서나 저장됨

- 콜 스택:

  - 우리가 함수를 실행하는 순서에 따라서 쌓아놓는 것
  - 함수들이 콜 스택에 차곡차곡 쌓여지고 호출되는 순서를 기억했다가 함수가 끝나면 쌓인 것들을 지우는 자료구조 중 하나
  - 모든 프로세스와 쓰레드는 각각 저마다의 콜 스택 사이즈 보유1
  - 재귀함수
    - 콜 스택을 잘못 쓰는 것을 재귀함수(함수안에서 자기 자신을 부름)
    - 재귀함수는 유용하지만 잘못 쓰면 콜 스택 사이즈 초과

  ```jsx
  👉 스택: `LIFO(last-in-first-out)` 라고 불리며, `push` 와 `pop`, `peek` 같은 API가 있음
  ```

  <br/>

# <span style="color: coral">👏🏻JS 실행 환경(=JS전체적인 실행 환경)</span>

> 멀티 쓰레딩이 불가한 JS는 기본적으로 할 수 있는 것이 매우 한정적

> 그러나, 브라우저 웹 APIs를 통해 웹 개발을 JS로 할 수 있는 것

> 대표적, `fetch()` 또는 `setTimeout()` 이며 자료구조 큐의 형태

 <br/>

## 🙋🏻‍♂️어떻게 웹APIs와 JS엔진이 서로 동작하는 것?

- 예를들어, 함수안에서 다시 `setTimeout()`을 호출했다고 가정

  - 호출하는 순간 `setTimeout()`은 콜백에서 지워짐
  - 웹 API는 타이머를 시작
  - 타이머 && JS 엔진은 병렬적 실행 👉 시간 끝나면 👉 웹 APIs는 `태스크 큐`에 콜백을 넣어줌

  ```jsx
  👉 큐: `FIFO(first-in-first-out)` 라고 불리며, 대표적 API는 `add` 와 `remove`, 가 있음
  ```

- 결국, 웹 APIs는 우리가 등록한 콜백 함수를 지정한 시간에 알아서 `태스크 큐`에 넣어줌
  - 🙋🏻‍♂️ 테스트 큐에 있는 콜백은 언제 실행?
    - : 이를 관찰하는 것이 바로 `Event Loop(이벤트 루프)`

### 🚨이벤트 루프?

- 이벤트 루프는 돌면서 콜 스택이 비워질 때까지 기다림
- 콜 스택이 텅텅 비어지면 (`setTimeout()`이 호출되고 실행되는 함수가 끝나면) JS가 더 이상 일을 하지 않을 때 이벤트 루프에 있는 `timeout callback` 을 실행
- 결국, 이벤트 루프는 프로세스가 동작하는 동안(=비동기 함수가 처리되는 동안) 콜 스택이 비워져 있다면 태스크 큐에 있는 것을 콜 스택으로 가져오는 역할

> 이해x❓ 예제: 버튼에 이벤트리스너를 등록하고 클릭을 하면, 웹API는 이벤트 루프에 콜백함수를 테스크 큐에 넣음

> 그리고 버튼이 또 일어나면 콜백함수가 또 태스크 큐에 들어옴

> 이벤트 루프가 콜백 로직이 다 수행이 되는 걸 확인하고 나서 먼저 클릭된 콜백 하나를 콜 스택에 가져와서 실행함

</br>

### 🙋🏻‍♂️ 맥락 정리?

1. JS엔진 동작과정

   > 웹 APIs에서 버튼 리스너 등록 ➡️ 이벤트 발생 ➡️ 웹 APIs가 태스크 큐에 콜백함수 등록 ➡️ 텅텅 빈 콜 스택 확인 -> 이벤트 루프가 태스크 큐에 있는 콜백함수 이동(태스크 큐 👉 콜 스택) ➡️ 콜백함수 실행

2. 설명

> 자바스크립트 엔진에는 `힙`과 `콜 스택`이 있다: 콜 스택은 함수가 실행되는 과정을 기억하기 위해 쓰이는 자료구조

> 자바스크립트가 동작하는 런타임 환경에서는 `태스크 큐`와 `마이크로 태스크 큐`를 이용해서 `비동기적 처리`를 한다. : 태스크 큐는 한 번에 하나씩만 콜백 함수를 가져옴 // 마이크로 태스크 큐는 자기자신 안에 들어있는 모든 콜백 함수가 다 수행할 때까지 가져옴 // 랜더는 주기적으로(매번x) UI를 업데이트 하기 위해서 이벤트 루프가 자주 들러줌 // 우리가 호출한 RAF(request frame callback queue)는 업데이트가 일어나기 전에 쭉 순회하면서 코드가 실행됨. 그래서 똑같은 RAF가 여러개 있을 때에는 최종적인 RAF함수의 코드블럭이 적용됨

</br>

출처:

- https://www.youtube.com/watch?v=8aGhZQkoFbQ&list=PLpjvGpURp3yjz_OYVkXdTq1TXX2P9SCbl&index=59&t=1416s
- https://www.charlezz.com/?p=44590
- https://www.youtube.com/watch?v=S1bVARd2OSE
